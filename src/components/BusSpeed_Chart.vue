<template>
  <div style="width: 370px">
    <el-descriptions :title="`${curVehicle.curVehicleInfo.vehicleId}`" :column = "2" class="Vehicle-des">
      <el-descriptions-item label="RouteId">{{curVehicle.curVehicleInfo.routeId}}</el-descriptions-item>
      <el-descriptions-item label="AgencyId">{{curVehicle.curVehicleInfo.agencyId}}</el-descriptions-item>
      <el-descriptions-item label="nextStop">{{curVehicle.curVehicleInfo.nextStop}}</el-descriptions-item>
      <el-descriptions-item label="speed">{{ curVehicle.curVehicleInfo.speed }} km/h</el-descriptions-item>
    </el-descriptions>
    <div style="width: 370px; height: 100px" ref="busSpeed"></div>
<!--TODO 加入当前轨迹的查看-->
  </div>
<!--TODO compare oneRoute different time, show more details-->
</template>

<script>
import * as echarts from 'echarts/core';
import {
  TooltipComponent,
  GridComponent,
  VisualMapComponent
} from 'echarts/components';
import { HeatmapChart } from 'echarts/charts';
import { CanvasRenderer } from 'echarts/renderers';

echarts.use([
  TooltipComponent,
  GridComponent,
  VisualMapComponent,
  HeatmapChart,
  CanvasRenderer
]);

export default {
  name: "BusSpeed_Chart",
  data() {
    return {
      // curVehicleInfo: {
      //   routeId: 0
      // }
      busSpeedChart: {},
      hours: [
        '00:00', '00:15', '00:30', '00:45',
        '01:00', '01:15', '01:30', '01:45',
        '02:00', '02:15', '02:30', '02:45',
        '03:00', '03:15', '03:30', '03:45',
        '04:00', '04:15', '04:30', '04:45',
        '05:00', '05:15', '05:30', '05:45',
        '06:00', '06:15', '06:30', '06:45',
        '07:00', '07:15', '07:30', '07:45',
        '08:00', '08:15', '08:30', '08:45',
        '09:00', '09:15', '09:30', '09:45',
        '10:00', '10:15', '10:30', '10:45',
        '11:00', '11:15', '11:30', '11:45',
        '12:00', '12:15', '12:30', '12:45',
        '13:00', '13:15', '13:30', '13:45',
        '14:00', '14:15', '14:30', '14:45',
        '15:00', '15:15', '15:30', '15:45',
        '16:00', '16:15', '16:30', '16:45',
        '17:00', '17:15', '17:30', '17:45',
        '18:00', '18:15', '18:30', '18:45',
        '19:00', '19:15', '19:30', '19:45',
        '20:00', '20:15', '20:30', '20:45',
        '21:00', '21:15', '21:30', '21:45',
        '22:00', '22:15', '22:30', '22:45',
        '23:00','23:15', '23:30', '23:45',
      ],
      days:[
        '01-01', '01-02', '01-03',
        '01-04', '01-05', '01-06', '01-07'
      ]
    }
  },
  props: {
    curVehicle:{
      curVehicleInfo: {
        vehicleId: "",
        routeId: "",
        agencyId: "",
        nextStop: "",
        speed: 0.0
      },
      curVehicleSpeedList: [],
    }
  },
  mounted() {
    this.init()
  },
  methods: {
    init() {
      let _this = this;
      _this.busSpeedChart = echarts.init(this.$refs.busSpeed);
      _this.busSpeedChart.resize();
      let option;
      //x(hour) y(day) speed(s)
      //test data
      const data = [
        [0, 0, 3], [0, 1, 1], [0, 2, 0], [0, 3, 10], [0, 4, 10], [0, 5, 2], [0, 6, 1], [0, 7, 9], [0, 8, 0], [0, 9, 8], [0, 10, 0], [0, 11, 6], [0, 12, 0], [0, 13, 0], [0, 14, 4], [0, 15, 4], [0, 16, 10], [0, 17, 6], [0, 18, 10], [0, 19, 8], [0, 20, 0], [0, 21, 1], [0, 22, 9], [0, 23, 7], [0, 24, 7], [0, 25, 10], [0, 26, 6], [0, 27, 4], [0, 28, 1], [0, 29, 2], [0, 30, 2], [0, 31, 0], [0, 32, 4], [0, 33, 1], [0, 34, 10], [0, 35, 4], [0, 36, 7], [0, 37, 2], [0, 38, 4], [0, 39, 9], [0, 40, 3], [0, 41, 9], [0, 42, 1], [0, 43, 0], [0, 44, 2], [0, 45, 9], [0, 46, 5], [0, 47, 3], [0, 48, 10], [0, 49, 7], [0, 50, 7], [0, 51, 4], [0, 52, 2], [0, 53, 9], [0, 54, 2], [0, 55, 9], [0, 56, 9], [0, 57, 7], [0, 58, 0], [0, 59, 4], [0, 60, 1], [0, 61, 10], [0, 62, 2], [0, 63, 6], [0, 64, 7], [0, 65, 5], [0, 66, 9], [0, 67, 0], [0, 68, 2], [0, 69, 5], [0, 70, 0], [0, 71, 0], [0, 72, 7], [0, 73, 9], [0, 74, 8], [0, 75, 7], [0, 76, 10], [0, 77, 8], [0, 78, 0], [0, 79, 8], [0, 80, 2], [0, 81, 0], [0, 82, 0], [0, 83, 8], [0, 84, 0], [0, 85, 2], [0, 86, 9], [0, 87, 10], [0, 88, 8], [0, 89, 1], [0, 90, 3], [0, 91, 10], [0, 92, 9], [0, 93, 10], [0, 94, 6], [0, 95, 3],
        [1, 0, 1], [1, 1, 1], [1, 2, 7], [1, 3, 8], [1, 4, 5], [1, 5, 0], [1, 6, 3], [1, 7, 10], [1, 8, 4], [1, 9, 6], [1, 10, 10], [1, 11, 2], [1, 12, 3], [1, 13, 4], [1, 14, 5], [1, 15, 4], [1, 16, 1], [1, 17, 7], [1, 18, 9], [1, 19, 8], [1, 20, 2], [1, 21, 1], [1, 22, 7], [1, 23, 7], [1, 24, 6], [1, 25, 0], [1, 26, 10], [1, 27, 0], [1, 28, 0], [1, 29, 3], [1, 30, 7], [1, 31, 9], [1, 32, 7], [1, 33, 3], [1, 34, 8], [1, 35, 6], [1, 36, 2], [1, 37, 3], [1, 38, 10], [1, 39, 0], [1, 40, 10], [1, 41, 7], [1, 42, 2], [1, 43, 10], [1, 44, 8], [1, 45, 6], [1, 46, 5], [1, 47, 10], [1, 48, 7], [1, 49, 1], [1, 50, 8], [1, 51, 6], [1, 52, 10], [1, 53, 3], [1, 54, 0], [1, 55, 4], [1, 56, 8], [1, 57, 9], [1, 58, 8], [1, 59, 0], [1, 60, 10], [1, 61, 4], [1, 62, 9], [1, 63, 8], [1, 64, 4], [1, 65, 0], [1, 66, 7], [1, 67, 9], [1, 68, 8], [1, 69, 0], [1, 70, 9], [1, 71, 9], [1, 72, 5], [1, 73, 5], [1, 74, 5], [1, 75, 8], [1, 76, 6], [1, 77, 1], [1, 78, 8], [1, 79, 0], [1, 80, 6], [1, 81, 6], [1, 82, 6], [1, 83, 4], [1, 84, 9], [1, 85, 2], [1, 86, 3], [1, 87, 1], [1, 88, 4], [1, 89, 5], [1, 90, 8], [1, 91, 9], [1, 92, 6], [1, 93, 4], [1, 94, 1], [1, 95, 3],
        [2, 0, 4], [2, 1, 8], [2, 2, 4], [2, 3, 5], [2, 4, 2], [2, 5, 3], [2, 6, 10], [2, 7, 2], [2, 8, 9], [2, 9, 10], [2, 10, 3], [2, 11, 3], [2, 12, 6], [2, 13, 9], [2, 14, 4], [2, 15, 4], [2, 16, 0], [2, 17, 7], [2, 18, 0], [2, 19, 0], [2, 20, 3], [2, 21, 0], [2, 22, 4], [2, 23, 2], [2, 24, 4], [2, 25, 10], [2, 26, 2], [2, 27, 6], [2, 28, 6], [2, 29, 2], [2, 30, 9], [2, 31, 9], [2, 32, 3], [2, 33, 0], [2, 34, 2], [2, 35, 7], [2, 36, 6], [2, 37, 5], [2, 38, 10], [2, 39, 6], [2, 40, 5], [2, 41, 0], [2, 42, 3], [2, 43, 9], [2, 44, 4], [2, 45, 3], [2, 46, 2], [2, 47, 8], [2, 48, 9], [2, 49, 7], [2, 50, 9], [2, 51, 0], [2, 52, 5], [2, 53, 1], [2, 54, 9], [2, 55, 3], [2, 56, 9], [2, 57, 8], [2, 58, 3], [2, 59, 8], [2, 60, 4], [2, 61, 10], [2, 62, 6], [2, 63, 3], [2, 64, 4], [2, 65, 7], [2, 66, 10], [2, 67, 8], [2, 68, 1], [2, 69, 9], [2, 70, 8], [2, 71, 4], [2, 72, 2], [2, 73, 1], [2, 74, 1], [2, 75, 3], [2, 76, 10], [2, 77, 0], [2, 78, 9], [2, 79, 7], [2, 80, 4], [2, 81, 7], [2, 82, 5], [2, 83, 8], [2, 84, 7], [2, 85, 6], [2, 86, 1], [2, 87, 3], [2, 88, 2], [2, 89, 3], [2, 90, 8], [2, 91, 8], [2, 92, 3], [2, 93, 3], [2, 94, 10], [2, 95, 2],
        [3, 0, 8], [3, 1, 1], [3, 2, 6], [3, 3, 4], [3, 4, 5], [3, 5, 0], [3, 6, 10], [3, 7, 3], [3, 8, 7], [3, 9, 1], [3, 10, 6], [3, 11, 5], [3, 12, 6], [3, 13, 3], [3, 14, 2], [3, 15, 4], [3, 16, 0], [3, 17, 5], [3, 18, 4], [3, 19, 5], [3, 20, 10], [3, 21, 9], [3, 22, 8], [3, 23, 7], [3, 24, 9], [3, 25, 4], [3, 26, 9], [3, 27, 7], [3, 28, 6], [3, 29, 4], [3, 30, 6], [3, 31, 4], [3, 32, 8], [3, 33, 8], [3, 34, 10], [3, 35, 2], [3, 36, 0], [3, 37, 7], [3, 38, 5], [3, 39, 6], [3, 40, 8], [3, 41, 4], [3, 42, 9], [3, 43, 7], [3, 44, 1], [3, 45, 3], [3, 46, 5], [3, 47, 2], [3, 48, 9], [3, 49, 6], [3, 50, 7], [3, 51, 10], [3, 52, 10], [3, 53, 3], [3, 54, 4], [3, 55, 1], [3, 56, 5], [3, 57, 7], [3, 58, 1], [3, 59, 6], [3, 60, 3], [3, 61, 3], [3, 62, 10], [3, 63, 6], [3, 64, 1], [3, 65, 4], [3, 66, 7], [3, 67, 8], [3, 68, 3], [3, 69, 9], [3, 70, 10], [3, 71, 3], [3, 72, 6], [3, 73, 0], [3, 74, 3], [3, 75, 0], [3, 76, 7], [3, 77, 10], [3, 78, 9], [3, 79, 1], [3, 80, 4], [3, 81, 7], [3, 82, 5], [3, 83, 6], [3, 84, 5], [3, 85, 9], [3, 86, 8], [3, 87, 7], [3, 88, 3], [3, 89, 7], [3, 90, 3], [3, 91, 3], [3, 92, 1], [3, 93, 7], [3, 94, 8], [3, 95, 5],
        [4, 0, 2], [4, 1, 4], [4, 2, 5], [4, 3, 2], [4, 4, 8], [4, 5, 3], [4, 6, 3], [4, 7, 5], [4, 8, 0], [4, 9, 0], [4, 10, 4], [4, 11, 2], [4, 12, 0], [4, 13, 9], [4, 14, 5], [4, 15, 4], [4, 16, 8], [4, 17, 5], [4, 18, 4], [4, 19, 4], [4, 20, 0], [4, 21, 8], [4, 22, 8], [4, 23, 2], [4, 24, 6], [4, 25, 5], [4, 26, 6], [4, 27, 2], [4, 28, 5], [4, 29, 0], [4, 30, 8], [4, 31, 2], [4, 32, 1], [4, 33, 0], [4, 34, 8], [4, 35, 2], [4, 36, 8], [4, 37, 9], [4, 38, 7], [4, 39, 2], [4, 40, 9], [4, 41, 9], [4, 42, 7], [4, 43, 10], [4, 44, 2], [4, 45, 8], [4, 46, 4], [4, 47, 0], [4, 48, 7], [4, 49, 3], [4, 50, 4], [4, 51, 5], [4, 52, 1], [4, 53, 2], [4, 54, 9], [4, 55, 0], [4, 56, 9], [4, 57, 0], [4, 58, 3], [4, 59, 7], [4, 60, 7], [4, 61, 2], [4, 62, 8], [4, 63, 6], [4, 64, 5], [4, 65, 10], [4, 66, 3], [4, 67, 1], [4, 68, 9], [4, 69, 2], [4, 70, 9], [4, 71, 10], [4, 72, 0], [4, 73, 1], [4, 74, 6], [4, 75, 10], [4, 76, 7], [4, 77, 5], [4, 78, 8], [4, 79, 8], [4, 80, 1], [4, 81, 3], [4, 82, 7], [4, 83, 4], [4, 84, 4], [4, 85, 5], [4, 86, 4], [4, 87, 3], [4, 88, 1], [4, 89, 10], [4, 90, 9], [4, 91, 2], [4, 92, 2], [4, 93, 7], [4, 94, 0], [4, 95, 3],
        [5, 0, 10], [5, 1, 5], [5, 2, 7], [5, 3, 4], [5, 4, 6], [5, 5, 6], [5, 6, 3], [5, 7, 10], [5, 8, 0], [5, 9, 7], [5, 10, 1], [5, 11, 7], [5, 12, 10], [5, 13, 6], [5, 14, 2], [5, 15, 2], [5, 16, 10], [5, 17, 1], [5, 18, 9], [5, 19, 3], [5, 20, 2], [5, 21, 1], [5, 22, 8], [5, 23, 1], [5, 24, 7], [5, 25, 8], [5, 26, 5], [5, 27, 10], [5, 28, 1], [5, 29, 9], [5, 30, 9], [5, 31, 9], [5, 32, 8], [5, 33, 7], [5, 34, 7], [5, 35, 2], [5, 36, 4], [5, 37, 6], [5, 38, 6], [5, 39, 10], [5, 40, 2], [5, 41, 7], [5, 42, 2], [5, 43, 10], [5, 44, 0], [5, 45, 3], [5, 46, 6], [5, 47, 2], [5, 48, 9], [5, 49, 3], [5, 50, 0], [5, 51, 7], [5, 52, 6], [5, 53, 1], [5, 54, 2], [5, 55, 6], [5, 56, 9], [5, 57, 5], [5, 58, 10], [5, 59, 7], [5, 60, 2], [5, 61, 10], [5, 62, 4], [5, 63, 6], [5, 64, 5], [5, 65, 9], [5, 66, 1], [5, 67, 5], [5, 68, 10], [5, 69, 1], [5, 70, 4], [5, 71, 0], [5, 72, 6], [5, 73, 8], [5, 74, 10], [5, 75, 6], [5, 76, 2], [5, 77, 0], [5, 78, 4], [5, 79, 3], [5, 80, 10], [5, 81, 5], [5, 82, 6], [5, 83, 4], [5, 84, 5], [5, 85, 0], [5, 86, 4], [5, 87, 8], [5, 88, 2], [5, 89, 4], [5, 90, 8], [5, 91, 2], [5, 92, 1], [5, 93, 5], [5, 94, 0], [5, 95, 2],
        [6, 0, 10], [6, 1, 2], [6, 2, 0], [6, 3, 0], [6, 4, 3], [6, 5, 7], [6, 6, 1], [6, 7, 2], [6, 8, 9], [6, 9, 5], [6, 10, 6], [6, 11, 3], [6, 12, 5], [6, 13, 5], [6, 14, 7], [6, 15, 9], [6, 16, 5], [6, 17, 5], [6, 18, 3], [6, 19, 2], [6, 20, 8], [6, 21, 2], [6, 22, 6], [6, 23, 5], [6, 24, 1], [6, 25, 3], [6, 26, 5], [6, 27, 2], [6, 28, 0], [6, 29, 10], [6, 30, 7], [6, 31, 7], [6, 32, 5], [6, 33, 8], [6, 34, 1], [6, 35, 3], [6, 36, 0], [6, 37, 5], [6, 38, 7], [6, 39, 8], [6, 40, 1], [6, 41, 7], [6, 42, 7], [6, 43, 4], [6, 44, 9], [6, 45, 8], [6, 46, 5], [6, 47, 1], [6, 48, 8], [6, 49, 9], [6, 50, 10], [6, 51, 10], [6, 52, 7], [6, 53, 6], [6, 54, 3], [6, 55, 8], [6, 56, 5], [6, 57, 5], [6, 58, 10], [6, 59, 2], [6, 60, 2], [6, 61, 9], [6, 62, 1], [6, 63, 4], [6, 64, 6], [6, 65, 7], [6, 66, 4], [6, 67, 6], [6, 68, 2], [6, 69, 0], [6, 70, 9], [6, 71, 5], [6, 72, 0], [6, 73, 0], [6, 74, 4], [6, 75, 7], [6, 76, 6], [6, 77, 10], [6, 78, 9], [6, 79, 1], [6, 80, 6], [6, 81, 10], [6, 82, 6], [6, 83, 2], [6, 84, 9], [6, 85, 9], [6, 86, 7], [6, 87, 0], [6, 88, 7], [6, 89, 5], [6, 90, 2], [6, 91, 5], [6, 92, 9], [6, 93, 9], [6, 94, 0], [6, 95, 8],
      ].map(function (item) {
            return [item[1], item[0], item[2] || '-'];
          });
      //chart option
      option = {
        title: {
          text: 'Bus Speed Chart',
          textStyle: {
            fontSize: 14
          }
        },
        tooltip: {
          position: 'top',
          formatter: function (item) {
            var res = item.marker + "<b> "+ item.data[2] + "km/h" + "</b></br>" +_this.days[item.data[1]] + " " + _this.hours[item.data[0]]
                ;
            return res;
          }
        },
        toolbox: {
          feature: {
            saveAsImage: {}
          },
          right:30
        },
        grid: {
          height: '40%',
          top: '30',
          left: '13%',
          width: '80%'
          // left: '20%'
        },
        xAxis: {
          type: 'category',
          data: _this.hours,
          splitArea: {
            show: true
          }
        },
        yAxis: {
          type: 'category',
          data: _this.days,
          splitArea: {
            show: true,
          }
        },
        visualMap: {
          min: 0,
          max: 60,
          calculable: true,
          orient: 'vertical',
          itemWidth: '10',
          itemHeight:"50%",
          inRange: {
            // color: ["#ff8c35", "#f9d382"] // 渐变颜色;
            color: ["#d6f9cf", "#0c9500"]
          },
          right: '0',
          top: '0%',
        },
        series: [
          {
            name: 'Speed',
            type: 'heatmap',
            data: data,
            label: {
              show: false
            },
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }
        ]
      };
      option && _this.busSpeedChart.setOption(option);
    },
    updateSpeedChartVehicleData() {
      let _this = this;
      var days = [];
      var speedLists = [];
      var speedData = []
      for(let i = 0; i < _this.curVehicle.curVehicleSpeedList.length; i++) {
        days.push(_this.curVehicle.curVehicleSpeedList[i].date);
        speedLists.push(_this.curVehicle.curVehicleSpeedList[i].speedList);
      }
      var option = _this.busSpeedChart.getOption();
      option.yAxis[0].data = days;
      _this.days = days;
      //concat speedList
      for(let i = 0; i < _this.curVehicle.curVehicleSpeedList.length; i ++) {
        let speedList = speedLists[i];
        var curData = [];
        for(let j = 0; j < speedList.length; j ++) {
          if(speedList[j] == 0)
            curData.push([j, i, null]);
          else curData.push([j,i,speedList[j].toFixed(2)]);
        }
        speedData = speedData.concat(curData);
      }
      option.series[0].data = speedData;
      _this.busSpeedChart.setOption(option);
    }
  }
}
</script>

<style scoped>
.Vehicle-des{
  margin-top: -20px
}
</style>